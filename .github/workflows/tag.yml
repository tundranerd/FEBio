name: CI - Annotate Tags

on:
  release:
    types: [published]

jobs:
  annotate-tag:
    name: "Annotate tag"
    runs-on: "ubuntu-latest"
    steps:
      - name: "Checkout code"
        uses: actions/checkout@v4
      - name: "Configure git"
        run: |
          git config user.email "workflow@febio.org"
          git config user.name "FEBIo Workflow"
      - name: "Annotate tag"
        run: |
          tag=${{ github.ref_name }}
          date="$(git show $tag --format=%aD | head -1)"
          GIT_COMMITTER_DATE="$date" git tag -a -f $tag $tag -m "Annotated ${tag}"
          git push --force origin $tag
          echo $?
          git describe --tags
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  call-linux-release:
    needs: annotate-tag
    uses: tundranerd/FEBio/.github/workflows/linux-release.yml@develop
    secrets: inherit

  call-windows-release:
    needs: annotate-tag
    uses: tundranerd/FEBio/.github/workflows/windows-release.yml@develop
    secrets: inherit

  call-macos-release:
    needs: annotate-tag
    uses: tundranerd/FEBio/.github/workflows/macos-release.yml@develop
    secrets: inherit
